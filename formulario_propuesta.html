<!DOCTYPE html>
<html lang="en" style="width: max-content; margin: auto;">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulario de Propuesta</title>
    
    <!-- <style>
        .required{required};

    </style> -->
</head>
<body>
    <img src="img/Escudo_Plasencia.png" alt="Escudo de Plasencia" style="height: 130px; display: block; margin: auto;">

    <hr style="height: 3px; background-color: grey;">

    <p style="text-align: center; font-size: 20px; font-weight: bolder;">FORMULARIO DE PROPUESTAS</p>
    <p style="text-align: center; font-size: 20px; font-weight: bolder;">PRESUPUESTOS PARTICIPATIVOS</p>

    <hr style="height: 3px; background-color: grey;">

    <form action="" method="get" onsubmit="return validarFormulario()">

        <label for="ocultardatoseconomicos">Ocultar datos económicos</label><input type="checkbox" id="ocultardatoseconomicos" name="ocultardatoseconomicos" checked onclick="mostrarpresupuesto()">

        <br>
        <br>

        <label for="" style="color: white; background-color: grey; display: block; padding-left: 8px; padding-bottom: 8px; padding-top: 4px; font-weight: bolder;">DATOS DE LA PROPUESTA</label>

        <br>

        <fieldset style="margin-bottom: 20px;">
            <legend>DATOS PERSONALES</legend>
                <!-- Nombre, apellidos, nif, telefono y correo -->
                <label for="nombre">Nombre</label>
                <input type="text" id="nombre" name="nombre" size="126" style=" margin-bottom: 10px;">

                <br>

                <label for="apellidos">Apellidos</label>
                <input type="text" id="apellidos" name="apellidos" style="width: 91.2%; margin-bottom: 10px;">

                <br>

                <label for="DNI">NIF/CIF</label>
                <input type="text" id="DNI" name="DNI" style="margin-bottom: 10px; width: 42%; ">

                <label for="telefono" style="margin-left: 20px;">Teléfono</label>
                <input type="txt" id="telefono" name="telefono" style="margin-bottom: 10px; width: 40%;">

                <br>

                <label for="correo">Correo electrónico</label>
                <input type="text" id="correo" name="correo" style="width: 85%; margin-bottom: 15px;">

                <label for="precargardatos" style="margin-left: 85%;">Precargar datos</label><input type="checkbox" name="precargardatos" id="precargardatos" style="margin-left: 5px;">
        </fieldset>

        <fieldset style="margin-bottom: 20px;">
            <legend>TITULO DE LA PROPUESTA</legend>
            <textarea name="titulopropuesta" id="titulopropuesta" cols="118" rows="3"></textarea>

        </fieldset>

        <fieldset style="margin-bottom: 20px;">
            <legend>DESCRIPCION DE LA PROPUESTA</legend>
            
            <textarea name="descripcionpropuesta" id="" cols="118" rows="5" placeholder="Breve descripción de la propesta (por ejemplo, poner una fuente en Main St.)"></textarea>
        </fieldset>

        <fieldset style="margin-bottom: 20px;">
            <legend>DESTINATARIOS</legend>

            <input type="checkbox"><label for="ninos">Niños</label>
            <input type="checkbox" style="margin-left: 170px;"><label for="jovenes">Jovenes</label>
            <input type="checkbox" style="margin-left: 170px;"><label for="ancianos">Ancianos</label>

        </fieldset>

        <fieldset style="margin-bottom: 20px;">
            <legend>BENEFICIOS DE LA PROPUESTA</legend>

            <input type="checkbox"><label for="infraestructuramunicipio">Mejora de las infraestructuras del municipio</label>

            <input type="checkbox" style="margin-left: 50px;"><label for="altademanda" style="display: inline-block;">Alta demanda</label>
            
            <br><br>

            <input type="checkbox"><label for="estructuraurbanistica">Mejora de la estructura ubrbanística del municipio</label>
            
            <input type="checkbox" style="margin-left: 10px;"><label for="estructuraturistica" style="display: inline-block;">Mejora de la estructura turística del municipio</label>
            
            <br><br>

            <input type="checkbox"><input type="text" placeholder="Cualquier otro beneficio">

        </fieldset>

        <div id="presupuestopropuesta" style="display: inline-flex;">
                <fieldset >
                    <legend>PRESUPUESTOS DE LA PROPUESTA</legend>
        
                    <input type="radio" name="presupuesto" id="menosdemil"><label for="menosdemil">Menos de 1000€</label>
                    <input type="radio" name="presupuesto" id="entremil" style="margin-left: 75px;"><label for="entremil">De 1000 a 5000€</label>
                    <input type="radio" name="presupuesto" id="masdediezmil" style="margin-left: 75px;"><label for="masdediezmil">De 5000 a 10000€</label>
        
                </fieldset>
        </div>
        
        <fieldset style="margin-bottom: 20px; margin-top: 20px;">
            <legend>DURACIÓN DE LA PROPUESTA</legend>

            <label for="">Fecha de inicio de la propuesta </label><input type="date">
            <label for="" style="margin-left: 90px;">Fecha de fin de la propuesta </label><input type="date">

        </fieldset>

        <fieldset>
            <legend>DOCUMENTACIÓN APORTADA</legend>
            <p style="margin-top: 0px;">Puede añadir fotos o cualquier otro documento que estime oportuno para la propuesta</p>

            <input type="file" name="examinar" id="examinar">
        </fieldset>
    
        <hr style="border: 2px solid grey;">

        <button style="position: absolute;" type="reset">Borrar formulario</button>
        <button style="margin-left: 94%;" type="submit">Enviar</button>
    </form>

    <img src="img/LogoPl.png" alt="Logo Ayuntamiento de Plasencia" style="display: block; margin: auto;">

    <script>
        
        const SEPARADOR_EMAIL = "@";

        // creo una función para ocultar por defecto los presupuestos de la propuesta
        function ocultarpresupuesto(){
            let presupuesto = document.getElementById("presupuestopropuesta")
            presupuesto.style.display='none'; 
            //hago un display ya que si uso visibility queda un espacio en blanco porque no se vé el contenido, pero la info sigue ahi, en cambio con el display none no se despliega la información
        };

        // llamo directamente a la función para que se ejecute por defecto ya que no se llama la función al hacer clic, tiene que ejecutarse al abrirse la pág.
        ocultarpresupuesto();


        // creo una función para que al pulsar el checkbox al principio del formulario, aparezcan los datos de los presupuestos de las propuestas
        function mostrarpresupuesto(){
            let presupuesto = document.getElementById("presupuestopropuesta")
            let checkbox = document.getElementById("ocultardatoseconomicos")

            if (checkbox.checked){
                presupuesto.style.display='none';
            }
            else {
                presupuesto.style.display='contents';
            }
        };


        function precargarDatos(){
            let datos= document.getElementById("precargardatos").value;
            let checkbox2 = document.getElementById("precargardatos");

            if (checkbox2.checked){
                document.getElementById('nombre').value = "Ángel";
                var input2 = document.getElementById('apellido1').value;
                var input4 = document.getElementById('DNI').value;
                var input6 = document.getElementById('telefono').value;
                var input5 = document.getElementById('email').value;
            }

        }



        // creo la función para comprobar si el teléfono introducido es correcto o no, para ello le paso una expresión regular y le digo que:
        // tiene que empezar por 6,7,8 o 9 y después tiene que tener un dígito del 1 al 9 y tiene que repetirse 8 veces
        function validarTelefono(){
            let valorRetorno=true;
            let contenidoTelefono = document.getElementById("telefono").value;
            const patronTlf=/^[6789]\d{8}$/;
            if (patronTlf.test(contenidoTelefono)==false){
                valorRetorno=false;
            }

            return valorRetorno;
        }

        // creo la función que comprueba si el DNI introducido es correcto, para ello utilizo una expresión regular que compara lo q le entra por parámetros con la expresión que tiene que comenzar por un dígito del al 9 repedido 8 veces y después debe ir una letra de la A a la Z y puede ser en mayúscula o en minúscula
        function validarDNI(){
            let valorRetorno=true;
            let contenidoDni = document.getElementById("DNI").value;
            
            // validacion del formato del DNI
            const patronDni=/^\d{8}[A-Z]|[a-z]$/;
            if (patronDni.test(contenidoDni)==false){
                valorRetorno=false;
            }

            // validacion de la letra del DNI 
            let letras = ['T', 'R', 'W', 'A', 'G', 'M', 'Y', 'F', 'P', 'D', 'X', 'B', 'N', 'J', 'Z', 'S', 'Q', 'V', 'H', 'L', 'C', 'K', 'E', 'T'];

            let letraDNI= letras[contenidoDni.substring(0, 8)%23];
            if (letraDNI != contenidoDni.charAt(8)){
                valorRetorno = false;
            }

            return valorRetorno;
        }

        // creo unna función que valida el email
        function validarEmail(){
            let valorRetorno=true; // Consideramos que la @ de correo es correcta
            
            // Obtener el valor del correo y eliminar espacios en blanco al inicio y al final
            let email=(document.getElementById("correo").value).trim();
            
            // Separar el correo en dos partes usando "@" como separador
            let vEmail=email.split("@");
            
            // Verificar si hay exactamente una "@" en el correo
            if (vEmail.length!=2){
                valorRetorno=false;
            } else {
                let nombre=vEmail[0]; // Obtener la parte antes de "@"
                let dominio=vEmail[1]; // Obtener la parte después de "@"
                
                // Verificar si la parte antes de "@" tiene algún contenido
                if (nombre.length==0){
                    valorRetorno=false;
                } else {
                    let vDominio=dominio.split('.'); // Separar el dominio usando "." como separador
                    
                    // Verificar si el dominio tiene al menos un punto para separar subdominios
                    if (vDominio.length<=1){
                        valorRetorno=false;
                    } else {
                        // Verificar cada parte del dominio para asegurarse de que no esté vacía
                        for(let i=0; ((i<vDominio.length) && (valorRetorno!=false)); i++){
                            if (vDominio[i].length==0){
                                valorRetorno=false;
                            }
                        }
                    }
                }                
            }

            // Lista de caracteres no permitidos en el correo electrónico
            let vCaracterNoPermitido=['$','%','€','*', '+', '-', ';', ',', '{', '}','ñ','¿','?','!','¡', '/', '\"', '\'', '\\', '|', '/'];
            
            // Verificar si el correo contiene algún carácter no permitido
            for (let j=0; ((j<vCaracterNoPermitido.length) && (valorRetorno!=false)); j++){
                if (email.includes(vCaracterNoPermitido[j])==true){
                    valorRetorno=false;
                }
            }

            return valorRetorno; // Devolver si el correo es válido o no
        }


        // creo una función que engloba a las otras 3 funciones y comprueba si el teléfono, DNI y email introducidos son correctos, sino muestra un alert/mensaje mostrando que el parámetro introducido es incorecto.
        function validarFormulario(){
            if (validarTelefono()==false){
                alert("El número de teléfono introducido es incorrecto.");
            }
            if (validarDNI()==false){
                alert("El DNI no tiene el formato correcto");
            }
            if (validarEmail()==false){
                alert("El email es incorrecto");
            }
        }



    </script>
</body>
</html>