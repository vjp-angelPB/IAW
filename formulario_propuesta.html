<!DOCTYPE html>
<html lang="en" style="width: max-content; margin: auto;">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulario de Propuesta</title>
    
    <!-- <style>
        .required{required};

    </style> -->
</head>
<body>

    <!-- Imagen con estilo css del escudo de plasencia -->
    <img src="../IAW/img/Escudo_Plasencia.png" alt="Escudo de Plasencia" style="height: 130px; display: block; margin: auto;">

    <hr style="height: 3px; background-color: grey;">

    <p style="text-align: center; font-size: 20px; font-weight: bolder;">FORMULARIO DE PROPUESTAS</p>
    <p style="text-align: center; font-size: 20px; font-weight: bolder;">PRESUPUESTOS PARTICIPATIVOS</p>

    <hr style="height: 3px; background-color: grey;">

    <!-- Creo el formulario con la función que lo valida -->
    <form action="anyAction" method="get" onsubmit="return validarFormulario();">

        <!-- Es el checkbox que te oculta los datos económicos si está seleccionado, con su correspondiente función -->
        <label for="ocultardatoseconomicos">Ocultar datos económicos</label><input type="checkbox" id="ocultardatoseconomicos" name="ocultardatoseconomicos" checked onclick="mostrarpresupuesto()">

        <br>
        <br>

        <label for="" style="color: white; background-color: grey; display: block; padding-left: 8px; padding-bottom: 8px; padding-top: 4px; font-weight: bolder;">DATOS DE LA PROPUESTA</label>

        <br>

        <!-- Campo de DATOS PERSONALES -->
        <fieldset style="margin-bottom: 20px;">
            <legend>DATOS PERSONALES</legend>
                <!-- Nombre, apellidos, nif, telefono y correo -->
                <label for="nombre">Nombre</label>
                <input type="text" id="nombre" name="nombre" size="126" style=" margin-bottom: 10px;">

                <br>

                <label for="apellidos">Apellidos</label>
                <input type="text" id="apellidos" name="apellidos" style="width: 91.2%; margin-bottom: 10px;">

                <br>

                <label for="DNI">NIF/CIF</label>
                <input type="text" id="DNI" name="DNI" style="margin-bottom: 10px; width: 42%; ">

                <label for="telefono" style="margin-left: 20px;">Teléfono</label>
                <input type="txt" id="telefono" name="telefono" style="margin-bottom: 10px; width: 40%;">

                <br>

                <label for="correo">Correo electrónico</label>
                <input type="text" id="correo" name="correo" style="width: 85%; margin-bottom: 15px;">

                <!-- Precargar datos con su función para que autocomplete los campos si fuera necesario -->
                <label for="precargardatos" style="margin-left: 85%;">Precargar datos</label><input type="checkbox" name="precargardatos" id="precargardatos" style="margin-left: 5px;" onclick="precargarDatos()">
        </fieldset>

        <!-- Campo de TÍTULO DE LA PROPUESTA -->
        <fieldset style="margin-bottom: 20px;">
            <legend>TITULO DE LA PROPUESTA</legend>
            <textarea name="titulopropuesta" id="titulopropuesta" cols="118" rows="3"></textarea>

        </fieldset>

        <!-- Campo de DESCIPCIÓN DE LA PROPUESTA -->
        <fieldset style="margin-bottom: 20px;">
            <legend>DESCRIPCION DE LA PROPUESTA</legend>
            
            <textarea name="descripcionpropuesta" id="descripcionpropuesta" cols="118" rows="5" placeholder="Breve descripción de la propesta (por ejemplo, poner una fuente en Main St.)"></textarea>
        </fieldset>

        <!-- Campo de DESTINATARIOS -->
        <fieldset style="margin-bottom: 20px;">
            <legend>DESTINATARIOS</legend>

            <input type="checkbox" name="ninos" id="ninos"><label for="ninos" id="ninoslabel">Niños</label>
            <input type="checkbox" name="jovenes" id="jovenes" style="margin-left: 170px;"><label for="jovenes" id="joveneslabel">Jovenes</label>
            <input type="checkbox" name="ancianos" id="ancianos" style="margin-left: 170px;"><label for="ancianos" id="ancianoslabel">Ancianos</label>

        </fieldset>

        <!-- Campo de BENEFICIOS DE LA PROPUESTA -->
        <fieldset style="margin-bottom: 20px;">
            <legend>BENEFICIOS DE LA PROPUESTA</legend>

            <input type="checkbox" name="infraestructuramunicipio" id="infraestructuramunicipio"><label for="infraestructuramunicipio" id="infraestructuramunicipiolabel">Mejora de las infraestructuras del municipio</label>

            <input type="checkbox" name="altademanda" id="altademanda" style="margin-left: 50px;"><label for="altademanda" style="display: inline-block;" id="altademandalabel">Alta demanda</label>
            
            <br><br>

            <input type="checkbox" name="estructuraurbanistica" id="estructuraurbanistica"><label for="estructuraurbanistica" id="estructuraurbanisticalabel">Mejora de la estructura ubrbanística del municipio</label>
            
            <input type="checkbox" name="estructuraturistica" id="estructuraturistica" style="margin-left: 10px; "><label for="estructuraturistica" style="display: inline-block;" id="estructuraturisticalabel">Mejora de la estructura turística del municipio</label>
            
            <br><br>

            <input type="checkbox" name="otrobeneficio" id="otrobeneficio"><input type="text" id="cualquierotrobeneficio" name="otrobeneficio" placeholder="Cualquier otro beneficio">

        </fieldset>

        <!-- Campo de PRESUPUESTOS DE LA PROPUESTA que por defecto aparecerá oculto y chequeado -->
        <div id="presupuestopropuesta" style="display: inline-flex;">
                <fieldset >
                    <legend>PRESUPUESTOS DE LA PROPUESTA</legend>
        
                    <input type="radio" name="presupuesto" id="menosdemil" checked><label for="menosdemil">Menos de 1000€</label>
                    <input type="radio" name="presupuesto" id="entremil" style="margin-left: 75px;"><label for="entremil">De 1000 a 5000€</label>
                    <input type="radio" name="presupuesto" id="masdediezmil" style="margin-left: 75px;"><label for="masdediezmil">De 5000 a 10000€</label>
        
                </fieldset>
        </div>
        
        <!-- Campo de DURACIÓN DE LA PROPUESTA -->
        <fieldset style="margin-bottom: 20px; margin-top: 20px;">
            <legend>DURACIÓN DE LA PROPUESTA</legend>

            <label for="fechainicio_propuesta">Fecha de inicio de la propuesta </label><input type="date" name="fechainicio_propuesta" id="fechainicio_propuesta" required>
            <label for="fechafin_propuesta" style="margin-left: 90px;">Fecha de fin de la propuesta </label><input type="date" name="fechafin_propuesta" id="fechafin_propuesta" required>

        </fieldset>

        <!-- Campo de DOCUMENTACIÓN APORTADA -->
        <fieldset>
            <legend>DOCUMENTACIÓN APORTADA</legend>
            <p style="margin-top: 0px;">Puede añadir fotos o cualquier otro documento que estime oportuno para la propuesta</p>

            <input type="file" name="examinar" id="examinar">
        </fieldset>
    
        <hr style="border: 2px solid grey;">

        <button style="position: absolute;" type="reset">Borrar formulario</button>
        <button style="margin-left: 94%;" type="submit">Enviar</button>
    </form>

    <img src="../IAW/img/LogoPl.png" alt="Logo Ayuntamiento de Plasencia" style="display: block; margin: auto;">

    <script>
        
        const SEPARADOR_EMAIL = "@";

        // creo una función para ocultar por defecto los presupuestos de la propuesta
        function ocultarpresupuesto(){
            let presupuesto = document.getElementById("presupuestopropuesta")
            presupuesto.style.display='none'; 
            //hago un display ya que si uso visibility queda un espacio en blanco porque no se vé el contenido, pero la info sigue ahi, en cambio con el display none no se despliega la información
        };

        // llamo directamente a la función para que se ejecute por defecto ya que no se llama la función al hacer clic, tiene que ejecutarse al abrirse la pág.
        ocultarpresupuesto();


        // creo una función para que al pulsar el checkbox al principio del formulario, aparezcan los datos de los presupuestos de las propuestas
        function mostrarpresupuesto(){
            let presupuesto = document.getElementById("presupuestopropuesta");
            let checkbox = document.getElementById("ocultardatoseconomicos");

            if (checkbox.checked){
                presupuesto.style.display='none';
            }
            else {
                presupuesto.style.display='contents';
            }
        };


        // creo una función para mostrar datos por defecto si está activado el checbox precargar datos y si no está activado se ponen por defecto a blanco
        function precargarDatos(){
            let precargar = document.getElementById("precargardatos");

            if (precargar.checked){
                document.getElementById('nombre').value = "Ángel";
                document.getElementById('apellidos').value = "Pérez Blanco";
                document.getElementById('DNI').value = "45139990Y";
                document.getElementById('telefono').value = "607493064";
                document.getElementById('correo').value = "aperezb33@informatica.iesvalledeljerteplasencia.es";
            }
            else {
                document.getElementById('nombre').value = "";
                document.getElementById('apellidos').value = "";
                document.getElementById('DNI').value = "";
                document.getElementById('telefono').value = "";
                document.getElementById('correo').value = "";
            }
        }

        // creo una función para asegurarme de que el usuario completa todos los campos que son obligatorios
        function camposObligatorios(){
            // DATOS DE LA PROPUESTA
            let Nombre = document.getElementById("nombre").value;
            let Apellidos = document.getElementById("apellidos").value;
            let Dni = document.getElementById("DNI").value;
            let Telefono = document.getElementById("telefono").value;
            let Correo = document.getElementById("correo").value;

            // TITULO DE LA PROPUESTA
            let TituloPropuesta = document.getElementById("titulopropuesta").value;

            // DESCRIPCION DE LA PROPUESTA
            let DescripcionPropuesta = document.getElementById("descripcionpropuesta").value;

            // DESTINATARIOS
            let Ninos = document.getElementById("ninos");
            let Jovenes = document.getElementById("jovenes");
            let Ancianos = document.getElementById("ancianos");

            // BENEFICIOS DE LA PROPUESTA
            let InfraestructuraMunicipio = document.getElementById("infraestructuramunicipio");
            let AltaDemanda = document.getElementById("altademanda");
            let EstructuraUrbanistica = document.getElementById("estructuraurbanistica");
            let EstructuraTuristica = document.getElementById("estructuraturistica");
            let OtroBeneficio = document.getElementById("otrobeneficio");
            let CualquierOtroBeneficio = document.getElementById("cualquierotrobeneficio").value;


            // INICIALIZAMOS LA VARIABLE VALOR RETORNO A TRUE POR DEFECTO   
            let valorRetorno=true;


            // COMPROBACIONES 

            // Comprobamos si los datos personales son correctos
            // Nombre === "" (es otra forma de hacerlo)
            if (Nombre.trim().length <= 0){
                alert("El campo Nombre es obligatorio.");
                document.getElementById("nombre").style.border = "solid 3px red";
                valorRetorno=false;
            } if (Apellidos.trim().length <= 0){
                alert("El campo Apellido es obligatorio.");
                document.getElementById("apellidos").style.border = "solid 3px red";
                valorRetorno=false;
            } if (Dni.trim().length <= 0){
                alert("El campo dni es obligatorio.");
                document.getElementById("DNI").style.border = "solid 3px red";
                valorRetorno=false;
            } if (Telefono.trim().length <= 0){
                alert("El campo Teléfono es obligatorio.");
                document.getElementById("telefono").style.border = "solid 3px red";
                valorRetorno=false;
            } if (Correo.trim().length <= 0){
                alert("El campo Correo es obligatorio.");
                document.getElementById("correo").style.border = "solid 3px red";
                valorRetorno=false;
            } 
            

            // comprobamos si el titulo de la propuesta es correcto
            if (TituloPropuesta.trim().length <= 0){
                alert("El campo Titulo de la Propuesta es obligatorio.");
                document.getElementById("titulopropuesta").style.border = "solid 3px red";
                valorRetorno=false;
            }


            // comprobamos si la descripcion de la propuesta es correcto
            if (DescripcionPropuesta.trim().length <= 0){
                alert("La Descripción de la Propuesta no puede estar vacía.");
                document.getElementById("descripcionpropuesta").style.border = "solid 3px red";
                valorRetorno=false;
            }

            // comprobamos si los destinatarios están seleccionados
            if ((!Ninos.checked) && (!Jovenes.checked) && (!Ancianos.checked)){
                alert("El campo Destinatarios no puede estar vacío, debe seleccionar una opción.");
                document.getElementById("ninoslabel").style.textDecoration = "underline red 2px";
                document.getElementById("joveneslabel").style.textDecoration = "underline red 2px";
                document.getElementById("ancianoslabel").style.textDecoration = "underline red 2px";
                valorRetorno=false;
            } 

            // comprobamos si los beneficios de la propuesta están seleccionados
            if ((!InfraestructuraMunicipio.checked) && (!AltaDemanda.checked) && (!EstructuraUrbanistica.checked) && (!EstructuraTuristica.checked) && ((CualquierOtroBeneficio.trim().length <= 0) && (!OtroBeneficio.checked))){
                alert("El campo Beneficios de la Propuesta no puede estar vacío, debe seleccionar alguna casilla.");
                document.getElementById("infraestructuramunicipiolabel").style.textDecoration = "underline red 2px";
                document.getElementById("altademandalabel").style.textDecoration = "underline red 2px";
                document.getElementById("estructuraurbanisticalabel").style.textDecoration = "underline red 2px";
                document.getElementById("estructuraturisticalabel").style.textDecoration = "underline red 2px";
                valorRetorno=false
            } 

            return valorRetorno;
        };



        // creo una función para validar que el número de teléfono que el usuario introduce es correcto
        function validarTelefono(){
            let valorRetorno=true;
            let contenidoTelefono = document.getElementById("telefono").value;
            const patronTlf=/^[6789]\d{8}$/;
            if (patronTlf.test(contenidoTelefono)==false){
                valorRetorno=false;
            }

            return valorRetorno;
        }

        // creo una función para validar que el DNI que el usuario introduce es correcto
        function validarDNI(){
            let valorRetorno=true;
            let contenidoDni = document.getElementById("DNI").value;
            
            // validacion del formato del DNI
            const patronDni=/^\d{8}[A-Z]|[a-z]$/;
            if (patronDni.test(contenidoDni)==false){
                valorRetorno=false;
            }

            // validacion de la letra del DNI 
            let letras = ['T', 'R', 'W', 'A', 'G', 'M', 'Y', 'F', 'P', 'D', 'X', 'B', 'N', 'J', 'Z', 'S', 'Q', 'V', 'H', 'L', 'C', 'K', 'E', 'T'];

            let letraDNI= letras[contenidoDni.substring(0, 8)%23];
            if (letraDNI != contenidoDni.charAt(8)){
                valorRetorno = false;
            }

            return valorRetorno;
        }

        // creo una función para validar si el correo que el usuario introduce es correcto.
        function validarEmail(){
            let valorRetorno=true; // Consideramos que la @de correo es correcta
            let email=(document.getElementById("correo").value).trim();
            let vEmail=email.split("@");
            if (vEmail.length!=2){
                valorRetorno=false;
            } else {
                let nombre=vEmail[0];
                let dominio=vEmail[1];
                if (nombre.length==0){
                    valorRetorno=false;
                } else {
                    let vDominio=dominio.split('.');
                    if (vDominio.length<=1){
                        valorRetorno=false;
                    }else{
                        for(let i=0; ((i<vDominio.length) && (valorRetorno!=false)) ; i++){
                            if (vDominio[i].length==0){
                                valorRetorno=false;
                            }
                        }
                    }
                }                
            }

            let vCaracterNoPermitido=['$','%','€','*', '+', '-', ';', ',', '{', '}','?', '/', '\"', '\'', '\\', '|', '/']; // Alguno más ....
            for (let j=0; ((j<vCaracterNoPermitido.length) && (valorRetorno!=false)); j++){
                if (email.includes(vCaracterNoPermitido[j])==true){
                    valorRetorno=false;
                }
            }

            return valorRetorno;
        }

        // creo una función que comprueba si las 3 funciones anteriores son correctas y sino muestra un alert diciendo el campo que no es correcto.
        function validarFormulario(){

            valorRetorno = true;

            if (validarTelefono()==false){
                alert("El número de teléfono introducido es incorrecto.");
                valorRetorno = false;
            }
            if (validarDNI()==false){
                alert("El DNI no tiene el formato correcto.");
                valorRetorno = false;
            }
            if (validarEmail()==false){
                alert("El correo introducido es incorrecto.");
                valorRetorno = false;
            }
            if (camposObligatorios()==false){
                alert("Faltan algunos campos por rellenar.");
                valorRetorno = false;
            }
            return valorRetorno;
        }



    </script>
</body>
</html>